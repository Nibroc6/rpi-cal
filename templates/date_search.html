{% extends "layout.html" %}
{% block body %}
<h1>Date Search</h1>
<form method="POST">
    <label for="search_date">Enter Date:</label>
    <input type="date" id="search_date" name="search_date" value="1824-11-05" required>
    <input type="submit" value="Search">
    <input type="submit" name="today" value="Use Today's Date">
</form>

{% if results %}
    <h2>Results for {{ search_date }}</h2>
    <table>
			<tr>
				<th>ID</th>
				<th>Start</th>
				<th>End</th>
				<th>Event Name</th>
				<th>More Info</th>
			</tr>
			{% for row in results %}
			<tr>
				<td>{{ row[0] }}</td>
				<td>{{ row[1] }}</td>
				<td>{{ row[2] }}</td>
				<td>{{ row[3] }}</td>
				<td><button onclick="showDetails('{{ row[0] }}')">Details</button></td>
			</tr>
			{% endfor %}
		</table>
{% elif search_performed %}
    <p>No results found for {{ search_date }}</p>
{% endif %}

<div id="overlay" class="overlay">
    <div class="popup">
        
        <a class="close" href="#" onclick="closePopup()">&times;</a>
        <div class="content" id="popup-content">
            <!-- Content will be dynamically inserted here -->
        </div>
    </div>
</div>

<style>
    .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.7);
        z-index: 1000;
    }
    .popup {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        border-radius: 5px;
        width: 300px;
    }
	
	td {
		padding-inline-end: 10px
	}
	
	
    .close {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 20px;
        font-weight: bold;
        text-decoration: none;
        color: #333;
    }
</style>

<script>
function showDetails(id) {
    fetch(`/get_details/${id}`)
        .then(response => response.json())
        .then(data => {
			data.start = data.start.substring(0, data.start.length-3);
			if(data.end != "Unknown"){data.end = data.end.substring(0, data.end.length-3);}
            document.getElementById('popup-content').innerHTML = `	
				<center><h2>${data.name}</h2></center>
                <p><strong>Start:</strong> ${data.start}</p>
                <p><strong>End:</strong> ${data.end}</p>
                <p><strong>Host:</strong> ${data.club_name}</p>
				<p><strong>Cost:</strong> ${data.cost}</p>
				<p><strong>Public event? (concert, etc.):</strong> ${data.public}</p>
				<p><strong>Location:</strong> ${data.location}</p>
				<p><strong>Description:</strong> ${data.description}</p>
				<p><strong>More info / where to learn more:</strong> ${data.more_info}</p>
				<img scr="/uploads/${data.image_id}">
            `;
            document.getElementById('overlay').style.display = 'block';
        });
}

function closePopup() {
    document.getElementById('overlay').style.display = 'none';
}
</script>
{% endblock %}